export default class skill {
	constructor(name, type) {
		this.skillName = name
		this.skillType = type
	}

	getExperienceFromLevel(level) {
		return this.levelExperience[level-1]
	}

	async readSkillJson() {
		const data = await import(`@/assets/skillData/${this.skillName}.json`)
		this.experienceSources = data.experienceSources
		this.invocations = data.invocations
		this.potions = data.potions
		this.baseActionTime = data.baseActionTime
		this.levelSpeedIncrease = data.levelSpeedIncrease
		if (this.invocations.length == 0 || this.invocations[this.invocations.length - 1].label != "None") {
			this.invocations.push({"label": "None"})
			this.potions.push({"label": "None"})
		}
	}

  findSubCraft(experienceSourceName) {
    for (const source of this.experienceSources) {
      if (source.label == experienceSourceName) {
        return source
      }
    }
    return null
  }

  calculateIterationExperince(experienceSource, prestigeCount, activeInvocation, activePotion, includeSubCrafts) {
    const invocationBonus = activeInvocation.bonusExperience ?? 0
    const potionBonus = activePotion.bonusExperience ?? 0
    var prestigeBonus = prestigeCount + 1
    if (prestigeCount == 10) {
      prestigeBonus = 15
    }

    var subCraftExperience = 0
    if (includeSubCrafts) {
    	const baseMaterial = this.findSubCraft(experienceSource.input[0].name)
    	if(baseMaterial != null) {
    		subCraftExperience = baseMaterial.baseExperience * experienceSource.input[0].inputAmount ?? 0
    	}
    }
    return (experienceSource["baseExperience"] + subCraftExperience) * prestigeBonus * (invocationBonus + potionBonus + 1)
  }

  generateTimeString(durationInSeconds) {
  	const days = Math.floor(durationInSeconds / (24 * 60 * 60))
    durationInSeconds - days * (24 * 60 * 60)

    const duration = new Date(0)
    duration.setSeconds(durationInSeconds - days * (24 * 60 * 60))
    try {
      const timeString = duration.toISOString().substring(11, 19)
      switch (days) {
        case 0:
          return timeString
        case 1:
          return days + " day " + timeString
        default: 
          return days + " days " + timeString
      }
    }
    catch(err) {
      console.error(err + " " + durationInSeconds)
      return "Error calulating time"
    }
  }

  getLevel(experience) {
  	for (let index = 0; index < this.levelExperience.length; index++) {
  		if (experience <= this.levelExperience[index]) {
  			return Math.max(1, index)
  		}
  	}
  	return this.levelExperience.length
  }

  calculateTotalTime(iterations, experienceSource, activePotion, includeSubCrafts, equipment, currentExperience) {
  	var calculatedTime = 0
  	if (this.skillType == "Artisan") {
  		calculatedTime = this.calculateCraftingTime(iterations, experienceSource, activePotion, includeSubCrafts)
  	}
  	if (this.skillType == "Gathering") {
  		calculatedTime = this.calculateGatheringTime(iterations, experienceSource, activePotion, equipment.progress, currentExperience)
  	}
  	return this.generateTimeString(calculatedTime)
  }

  calculateCraftingTime(iterations, experienceSource, activePotion, includeSubCrafts) {
    const potionTimeReduction = activePotion.timeReduction ?? 0

    var duration = iterations * (experienceSource.baseCraftingTime - potionTimeReduction)
    const baseMaterial = this.findSubCraft(experienceSource.input[0].name)
    if (includeSubCrafts && baseMaterial != null) {
      const subCraftDuration = iterations * experienceSource.input[0].inputAmount * (baseMaterial.baseCraftingTime - potionTimeReduction)
      duration += subCraftDuration
    }
    return duration
  }

  calculateGatheringTime(iterations, experienceSource, activePotion, equipmentProgress, currentExperience) {
  	const potionProgress = activePotion.bonusProgress ?? 0

  	const timePerAction = this.baseActionTime - this.levelSpeedIncrease * this.getLevel(currentExperience)
  	const actionsPerResource = 100 / (equipmentProgress + potionProgress)
  	return timePerAction * actionsPerResource * iterations
  }

  equipmentTiers = [
    {
      "label": "Bronze",
      "progress": 15
    },
    {
      "label": "Iron",
      "progress": 20
    },
    {
      "label": "Steel",
      "progress": 25
    },
    {
      "label": "Mithril",
      "progress": 30
    },
    {
      "label": "Adamantite",
      "progress": 35
    },
    {
      "label": "Cerulium",
      "progress": 40
    },
    {
      "label": "Sanguinite",
      "progress": 50
    },
    {
      "label": "Aeronite",
      "progress": 60
    },
    {
      "label": "Necrosis",
      "progress": 70
    },
    {
      "label": "Phantom",
      "progress": 80
    },
    {
      "label": "Karinite",
      "progress": 90
    },
    {
      "label": "Taigite",
      "progress": 100
    },
    {
      "label": "Cryxcite",
      "progress": 110
    },
    {
      "label": "Golden",
      "progress": 55
    }
  ]

	levelExperience = [
		0,
		83,
		174,
		276,
		388,
		512,
		650,
		801,
		969,
		1154,
		1358,
		1584,
		1833,
		2107,
		2411,
		2746,
		3115,
		3523,
		3973,
		4470,
		5018,
		5624,
		6291,
		7028,
		7842,
		8740,
		9730,
		10824,
		12031,
		13363,
		14833,
		16456,
		18247,
		20224,
		22406,
		24815,
		27473,
		30408,
		33648,
		37224,
		41171,
		45529,
		50339,
		55649,
		61512,
		67983,
		75127,
		83014,
		91721,
		101333,
		111945,
		123660,
		136594,
		150872,
		166636,
		184040,
		203254,
		224466,
		247886,
		273742,
		302288,
		333804,
		368599,
		407015,
		449428,
		496254,
		547953,
		605032,
		668051,
		737627,
		814445,
		899257,
		992895,
		1096278,
		1210421,
		1336443,
		1475581,
		1629200,
		1798808,
		1986068,
		2192818,
		2421087,
		2673114,
		2951373,
		3258594,
		3597792,
		3972294,
		4385776,
		4842295,
		5346332,
		5902831,
		6517253,
		7195629,
		7944614,
		8771558,
		9684577,
		10692629,
		11805606,
		13034431,
		14391160,
		15747890,
		17105990,
		18465450,
		19826290,
		21188510,
		22552090,
		23917060,
		25283400,
		26651120,
		28020220,
		29390700,
		30762560,
		32135810,
		33510440,
		34886460,
		36263870,
		37642670,
		39022860,
		40404440,
		41787420,
		43171790,
		44557560,
		45944730,
		47333300,
		48723260,
		50114630,
		51507400,
		52901580,
		54297170,
		55694160,
		57092560,
		58492380,
		59893610,
		61296250,
		62700300,
		64105780,
		65512670,
		66920980,
		68330700,
		69741860,
		71154430,
		72568430,
		73983860,
		75400720,
		76819010,
		78238730,
		79659880,
		81082460,
		82506480,
		83931940,
		85358830,
		86787170,
		88216940,
		89648160,
		91080820,
		92514930,
		93950480,
		95387480,
		96825940,
		98265840,
		99707200,
		101150000,
		102594300,
		104040000,
		105487200,
		106935800,
		108385900,
		109837500,
		111290500,
		112745000,
		114201000,
		115658400,
		117117300,
		118577700,
		120039600,
		121502900,
		122967700,
		124434000,
		125901700,
		127371000,
		128841700,
		130313900,
		131787600,
		133262800,
		134739500,
		136217600,
		137697300,
		139178400,
		140661000,
		142145200,
		143630800,
		145117900,
		146606600,
		148096700,
		149588300,
		151081500,
		152576100,
		154072300,
		155569900,
		157069100,
		158569800,
		160072000,
		161575700,
		163081000,
		164587700,
		166096000,
		167605800,
		169117100,
		170630000,
		172144300,
		173660200,
		175177600,
		176696600,
		178217100,
		179739100,
		181262700,
		182787800,
		184314400,
		185842600,
		187372400,
		188903600,
		190436400,
		191970800,
		193506700,
		195044100,
		196583200,
		198123700,
		199665800,
		201209500,
		202754700,
		204301500,
		205849900,
		207399800,
		208951200,
		210504300,
		212058900,
		213615100,
		215172800,
		216732100,
		218293000,
		219855500,
		221419500,
		222985100,
		224552300,
		226121100,
		227691500,
		229263400,
		230837000,
		232412100,
		233988800,
		235567100,
		237147000,
		238728500,
		240311600,
		241896300,
		243482500,
		245070400,
		246659900,
		248251000,
		249843700,
		251438000,
		253033900,
		254631400,
		256230500,
		257831300,
		259433600,
		261037600,
		262643200,
		264250400,
		265859200,
		267469700,
		269081800,
		270695500,
		272310800,
		273927800,
		275546400,
		277166600,
		278788400,
		280411900,
		282037100,
		283663900,
		285292300,
		286922400,
		288554100,
		290187400,
		291822400,
		293459100,
		295097400,
		296737300,
		298378900,
		300022200,
		301667100,
		303313700,
		304962000,
		306611900,
		308263500,
		309916700,
		311571600,
		313228200,
		314886500,
		316546400,
		318208000,
		319871300,
		321536200,
		323202800,
		324871200,
		326541200,
		328212900,
		329886200,
		331561300,
		333238000,
		334916500,
		336596600,
		338278400,
		339962000,
		341647200,
		343334100,
		345022700,
		346713100,
		348405100,
		350098800,
		351794300,
		353491500,
		355190300,
		356890900,
		358593200,
		360297200,
		362003000,
		363710500,
		365419600,
		367130600,
		368843200,
		370557600,
		372273700,
		373991500,
		375711000,
		377432400,
		379155400,
		380880200,
		382606700,
		384334900,
		386064900,
		387796700,
		389530200,
		391265400,
		393002400,
		394741200,
		396481700,
		398223900,
		399967900,
		401713700,
		403461200,
		405210500,
		406961600,
		408714400,
		410469000,
		412225300,
		413983500,
		415743400,
		417505100,
		419268500,
		421033800,
		422800800,
		424569600,
		426340200,
		428112600,
		429886800,
		431662800,
		433440500,
		435220100,
		437001400,
		438784500,
		440569500,
		442356200,
		444144800,
		445935100,
		447727300,
		449521200,
		451317000,
		453114600,
		454914000,
		456715200,
		458518200,
		460323100,
		462129700,
		463938200,
		465748500,
		467560600,
		469374600,
		471190400,
		473008100,
		474827500,
		476648800,
		478472000,
		480297000,
		482123800,
		483952400,
		485782900,
		487615300,
		489449500,
		491285600,
		493123500,
		494963300,
		496804900,
		498648400,
		500493700,
		502340900,
		504190000,
		506040900,
		507893700,
		509748400,
		511604900,
		513463300,
		515323600,
		517185800,
		519049800,
		520915700,
		522783600,
		524653200,
		526524800,
		528398300,
		530273700,
		532150900,
		534030000,
		535911100,
		537794000,
		539678800,
		541565600,
		543454200,
		545344800,
		547237200,
		549131600,
		551027800,
		552926000,
		554826100,
		556728100,
		558632100,
		560537900,
		562445700,
		564355400,
		566267000,
		568180500,
		570096100,
		572013500,
		573932900,
		575854100,
		577777400,
		579702600,
		581629700,
		583558800,
		585489800,
		587422800,
		589357700,
		591294500,
		593233300,
		595174100,
		597116900,
		599061600,
		601008200,
		602956800,
		604907400,
		606860000,
		608814500,
		610770900,
		612729400,
		614689900,
		616652300,
		618616700,
		620583100,
		622551500,
		624521900,
		626494200,
		628468500,
		630444900,
		632423200,
		634403500,
		636385800,
		638370100,
		640356400,
		642344800,
		644335100,
		646327400,
		648321800,
		650318100,
		652316500,
		654316900,
		656319400,
		658323800,
		660330200,
		662338700,
		664349200,
		666361700,
		668376300,
		670392800,
		672411500,
		674432100,
		676454800,
		678479600,
		680506400,
		682535200,
		684566100,
		686599000,
		688634000,
		690671100,
		692710200,
		694751400,
		696794600,
		698839800,
		700887200,
		702936600,
		704988000,
		707041500,
		709097200,
		711154800,
		713214600,
		715276400,
		717340400,
		719406300,
		721474400,
		723544600,
		725616800,
		727691200,
		729767600,
		731846100,
		733926800,
		736009500,
		738094400,
		740181300,
		742270300,
		744361500,
		746454700,
		748550100,
		750647600,
		752747100,
		754848800,
		756952700,
		759058700,
		761166800,
		763277000,
		765389300,
		767503800,
		769620400,
		771739100,
		773860000,
		775983000,
		778108200,
		780235500,
		782365000,
		784496600,
		786630300,
		788766300,
		790904300,
		793044500,
		795186900,
		797331500,
		799478100,
		801627000,
		803778000,
		805931300,
		808086700,
		810244200,
		812404000,
		814565900,
		816730000,
		818896300,
		821064700,
		823235300,
		825408200,
		827583200,
		829760400,
		831939900,
		834121500,
		836305300,
		838491400,
		840679600,
		842870100,
		845062700,
		847257600,
		849454700,
		851654000,
		853855500,
		856059200,
		858265200,
		860473300,
		862683800,
		864896400,
		867111300,
		869328400,
		871547700,
		873769300,
		875993100,
		878219100,
		880447500,
		882678100,
		884910900,
		887146000,
		889383300,
		891622900,
		893864800,
		896108900,
		898355300,
		900603900,
		902854800,
		905108000,
		907363400,
		909621100,
		911881200,
		914143400,
		916408000,
		918674900,
		920944000,
		923215400,
		925489200,
		927765200,
		930043500,
		932324200,
		934607100,
		936892300,
		939179800,
		941469700,
		943761900,
		946056300,
		948353100,
		950652200,
		952953500,
		955257300,
		957563300,
		959871700,
		962182400,
		964495400,
		966810800,
		969128500,
		971448600,
		973770900,
		976095700,
		978422800,
		980752200,
		983084000,
		985418100,
		987754600,
		990093400,
		992434600,
		994778200,
		997124100,
		999472400,
		1001823000,
		1004176000,
		1006531000,
		1008889000,
		1011249000,
		1013612000,
		1015977000,
		1018344000,
		1020714000,
		1023086000,
		1025460000,
		1027837000,
		1030217000,
		1032598000,
		1034982000,
		1037369000,
		1039758000,
		1042149000,
		1044543000,
		1046939000,
		1049338000,
		1051738000,
		1054142000,
		1056548000,
		1058956000,
		1061367000,
		1063780000,
		1066195000,
		1068613000,
		1071034000,
		1073457000,
		1075882000,
		1078310000,
		1080740000,
		1083172000,
		1085608000,
		1088045000,
		1090485000,
		1092928000,
		1095373000,
		1097820000,
		1100270000,
		1102722000,
		1105177000,
		1107635000,
		1110094000,
		1112557000,
		1115021000,
		1117489000,
		1119958000,
		1122431000,
		1124905000,
		1127383000,
		1129862000,
		1132344000,
		1134829000,
		1137316000,
		1139806000,
		1142298000,
		1144793000,
		1147290000,
		1149790000,
		1152293000,
		1154797000,
		1157305000,
		1159815000,
		1162327000,
		1164842000,
		1167360000,
		1169880000,
		1172402000,
		1174928000,
		1177455000,
		1179986000,
		1182519000,
		1185054000,
		1187592000,
		1190132000,
		1192675000,
		1195221000,
		1197769000,
		1200320000,
		1202873000,
		1205429000,
		1207987000,
		1210548000,
		1213112000,
		1215678000,
		1218247000,
		1220819000,
		1223393000,
		1225969000,
		1228548000,
		1231130000,
		1233715000,
		1236302000,
		1238891000,
		1241483000,
		1244078000,
		1246676000,
		1249276000,
		1251879000,
		1254484000,
		1257092000,
		1259702000,
		1262316000,
		1264931000,
		1267550000,
		1270171000,
		1272795000,
		1275421000,
		1278050000,
		1280682000,
		1283317000,
		1285954000,
		1288593000,
		1291236000,
		1293881000,
		1296529000,
		1299179000,
		1301832000,
		1304488000,
		1307146000,
		1309807000,
		1312471000,
		1315138000,
		1317807000,
		1320479000,
		1323153000,
		1325830000,
		1328510000,
		1331193000,
		1333878000,
		1336566000,
		1339257000,
		1341951000,
		1344647000,
		1347346000,
		1350047000,
		1352752000,
		1355459000,
		1358169000,
		1360881000,
		1363597000,
		1366315000,
		1369036000,
		1371759000,
		1374485000,
		1377214000,
		1379946000,
		1382681000,
		1385418000,
		1388158000,
		1390901000,
		1393647000,
		1396395000,
		1399146000,
		1401900000,
		1404657000,
		1407416000,
		1410179000,
		1412944000,
		1415711000,
		1418482000,
		1421256000,
		1424032000,
		1426811000,
		1429593000,
		1432377000,
		1435165000,
		1437955000,
		1440748000,
		1443544000,
		1446343000,
		1449144000,
		1451949000,
		1454756000,
		1457566000,
		1460379000,
		1463194000,
		1466013000,
		1468834000,
		1471659000,
		1474486000,
		1477316000,
		1480148000,
		1482984000,
		1485823000,
		1488664000,
		1491508000,
		1494355000,
		1497206000,
		1500058000,
		1502914000,
		1505773000,
		1508634000,
		1511499000,
		1514366000,
		1517236000,
		1520109000,
		1522985000,
		1525864000,
		1528746000,
		1531631000,
		1534518000,
		1537409000,
		1540302000,
		1543199000,
		1546098000,
		1549000000,
		1551905000,
		1554813000,
		1557724000,
		1560638000,
		1563555000,
		1566475000,
		1569398000,
		1572323000,
		1575252000,
		1578183000,
		1581118000,
		1584056000,
		1586996000,
		1589940000,
		1592886000,
		1595835000,
		1598788000,
		1601743000,
		1604702000,
		1607663000,
		1610627000,
		1613594000,
		1616565000,
		1619538000,
		1622514000,
		1625494000,
		1628476000,
		1631461000,
		1634450000,
		1637441000,
		1640435000,
		1643433000,
		1646433000,
		1649437000,
		1652443000,
		1655453000,
		1658465000,
		1661481000,
		1664499000,
		1667521000,
		1670546000,
		1673574000,
		1676604000,
		1679638000,
		1682675000,
		1685715000,
		1688758000,
		1691804000,
		1694854000,
		1697906000,
		1700961000,
		1704020000,
		1707081000,
		1710146000,
		1713213000,
		1716284000,
		1719358000,
		1722435000,
		1725515000,
		1728599000,
		1731685000,
		1734774000,
		1737867000,
		1740963000,
		1744061000,
		1747163000,
		1750268000,
		1753377000,
		1756488000,
		1759602000,
		1762720000,
		1765841000,
		1768965000,
		1772092000,
		1775222000,
		1778355000,
		1781492000,
		1784632000,
		1787775000,
		1790921000,
		1794070000,
		1797222000,
		1800378000,
		1803537000,
		1806699000,
		1809864000,
		1813032000,
		1816204000,
		1819379000,
		1822557000,
		1825738000,
		1828922000,
		1832110000,
		1835300000,
		1838494000,
		1841692000,
		1844892000,
		1848096000,
		1851303000,
		1854513000,
		1857726000,
		1860943000,
		1864163000,
		1867386000,
		1870612000,
		1873842000,
		1877075000,
		1880311000,
		1883550000,
		1886793000,
		1890039000,
		1893288000,
		1896541000,
		1899797000,
		1903056000,
		1906318000,
		1909584000,
		1912853000,
		1916125000,
		1919401000,
		1922680000,
		1925962000,
		1929247000,
		1932536000,
		1935828000,
		1939124000,
		1942423000,
		1945725000,
		1949030000,
		1952339000,
		1955651000,
		1958967000,
		1962285000,
		1965607000,
		1968933000,
		1972262000,
		1975594000,
		1978930000,
		1982268000,
		1985611000,
		1988956000,
		1992305000,
		1995658000,
		1999014000,
		2000000000
	]
}